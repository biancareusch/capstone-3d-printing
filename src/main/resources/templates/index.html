<!DOCTYPE html>
<html lang="eng" xmlns:th="http://www.thymeleaf.org">
<head th:replace="partials/header_partial :: head">
    <title id="pageTitle">Browse Files</title>
    <script type="module" th:src="@{/js/indexRender.js}"></script>
</head>
<body class="colorBackground">
<nav class="sticky-top" th:replace="partials/navbar :: navbar"></nav>

<!--<h1 th:if="${requestedCategories == null}">All files</h1>-->
<!--<h1 th:if="${requestedCategories != null}" th:text="${requestedCategories.category}"></h1>-->
<div class="container">
    <h1 class="mt-3" th:text="${pageTitle}"></h1>
    <div class="row">
        <div class="col-1 col-sm-2">
            <div class="list-group fs-5">
                <div onclick="allCategories()" style="cursor: pointer;"
                     class="list-group-item list-group-item-action backgroundDiv link-danger m-0 d-flex justify-content-between align-items-center rounded-0">
                    All Categories<span class="badge bg-danger" th:text="${totalFileNumber}"></span></div>
                <script>
                    function allCategories() {
                        $(".fileCard").each(function () {
                            $(this).removeClass("d-none");
                        })
                    }
                </script>
                <!--                <div th:each="category : ${categories}" class="list-group-item list-group-item-action backgroundDiv d-flex justify-content-between align-items-center m-0">-->
                <!--                    <a th:href="@{'/files/' + '?category=' + ${category.category}}"-->
                <!--                       class="link-danger" th:text="${category.category}"></a>-->
                <!--                    <span class="badge bg-danger rounded-pill">14</span>-->
                <!--                </div>-->

                <div th:each="categoryhash : ${categoryHashmap}" onclick="switchTo(this)" style="cursor: pointer;"
                     class="list-group-item list-group-item-action backgroundDiv d-flex justify-content-between align-items-center m-0 rounded-0"
                     th:data-category="${categoryhash.key}">
                    <span class="link-danger text-decoration-none" th:text="${categoryhash.key}"></span>
                    <!--                    <a th:href="@{'/files/' + '?category=' + ${categoryhash.getKey()}}"-->
                    <!--                       class="link-danger text-decoration-none" th:text="${categoryhash.key}"></a>-->
                    <span class="badge bg-danger" th:text="${categoryhash.getValue()}"></span>
                    <script>
                        function switchTo(element) {
                            let categoryName = element.dataset.category;
                            $(".fileCard").each(function () {
                                if ($(this).hasClass(categoryName)) {
                                    $(this).removeClass("d-none");
                                } else {
                                    $(this).addClass("d-none");
                                }
                            });


                        }
                    </script>
                </div>
            </div>
        </div>
        <div class="col-sm-9">
            <div class="row justify-content-between content">
                <div class="fileCard backgroundDiv col-11 col-md-3 col-lg-3 col-sm-10 d-flex flex-column align-items-center justify-content-between fs-5"
                     th:each="file : ${files}" th:id="${'file' + file.id}">
                    <div class="card-img dontShowOnMobile" style="height: 100px; width: 100px" th:data-original-title="${file.fileUrl}" th:id="${'renderIndex' + file.id}">
                        <script type="module" th:src="@{/js/indexRender.js}"></script>
                    </div>

                    <div class="mt-2">
                        <a th:href="@{'/files/' + ${file.id}}" th:text="${file.title}"></a>
                        <!--                <p th:text="${file.description}"></p>-->
                        <div class="d-none" th:each="category : ${file.categories}">
                            <script th:inline="javascript">
                                function addCategoryClasses() {
                                    let id = /*[[${file.id}]]*/;
                                    $("#file" + id).addClass(/*[[${category.category}]]*/);
                                }

                                addCategoryClasses();
                            </script>
                        </div>
                    </div>
                    <div class="align-self-start">
                        <span>By: </span><a th:href="@{'/profile/' + ${file.owner.id}}"
                                            th:text="${file.owner.username}"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-9">
            <div class="row justify-content-between content">
                <h1 class="mt-3" th:text="${userResults}"></h1>
                <div class="backgroundDiv col-11 col-md-3 col-lg-3 col-sm-10 d-flex flex-column align-items-center justify-content-between fs-5"
                     th:each="user : ${users}">
                    <img class="image" th:src="${user.getAvatarUrl()}"
                         alt="randomized picture">
                    <div class="mt-2">
                        <a th:href="@{'/profile/' + ${user.id}}" th:text="${user.username}"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module" th:src="@{/js/indexRender.js}"></script>
<footer th:replace="partials/footer_partial :: footer"></footer>
<section th:replace="partials/partials_scripts :: script"></section>

</body>
</html>
